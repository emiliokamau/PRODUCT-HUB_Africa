{% extends 'base.html' %} {% block title %}Forgot Password{% endblock %} {%
block content %}
<!DOCTYPE html>
<html>
  <head>
    <title>Forgot Password</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      .error-message {
        color: #b22222; /* Red Clay for errors */
        font-size: 0.9em;
        display: none;
      }
      .notifications .alert-success {
        background-color: #4a90e2; /* Sky Blue for success */
        color: white;
      }
      .notifications .alert-danger {
        background-color: #b22222; /* Red Clay for errors */
        color: white;
      }
      .btn-primary {
        background-color: #3d8b40; /* Acacia Green */
        border-color: #3d8b40;
      }
      .btn-link {
        color: #f28c38; /* Sunset Orange */
      }
      .btn-help {
        color: #f28c38; /* Sunset Orange */
      }
      .language-toggle {
        background-color: #3d8b40; /* Acacia Green */
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
      }
      .tips-sidebar {
        background-color: #f5e8c7; /* Savanna Beige */
        padding: 15px;
        border-radius: 5px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <h1
        style="color: #3d8b40"
        data-en="Reset Your Password"
        data-sw="Weka Upya Nenosiri Lako"
      >
        Reset Your Password
      </h1>
      <p
        data-en="Enter your email or phone number to receive a password reset link."
        data-sw="Ingiza barua pepe au nambari ya simu ili upokee kiungo cha kuweka upya nenosiri."
      >
        Enter your email or phone number to receive a password reset link.
      </p>

      <section class="notifications">
        {% with messages = get_flashed_messages(with_categories=true) %} {% if
        messages %} {% for category, message in messages %}
        <div
          class="alert alert-{{ 'danger' if category == 'error' else 'success' }}"
        >
          {{ message }}
        </div>
        {% endfor %} {% endif %} {% endwith %}
      </section>

      <form
        method="POST"
        action="{{ url_for('auth.forgot_password') }}"
        id="forgotPasswordForm"
      >
        <!-- CSRF Token -->
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <div class="mb-3">
          <label
            for="identifier"
            class="form-label"
            data-en="Email or Phone Number"
            data-sw="Barua Pepe au Nambari ya Simu"
            >Email or Phone Number</label
          >
          <input
            type="text"
            class="form-control"
            name="identifier"
            id="identifier"
            placeholder="example@email.com or +254712345678"
            required
          />
          <p id="identifierError" class="error-message">
            Please enter a valid email or phone number in the format
            +254XXXXXXXXX.
          </p>
        </div>
        <button type="submit" class="btn btn-primary">Send Reset Link</button>
      </form>

      <p class="mt-3">
        <a
          href="{{ url_for('auth.login') }}"
          class="btn btn-link"
          data-en="Back to Login"
          data-sw="Rudi kwenye Kuingia"
          >Back to Login</a
        >
      </p>
      <p class="mt-3">
        <a
          href="{{ url_for('auth.support') }}"
          class="btn btn-help"
          data-en="Need Help?"
          data-sw="Unahitaji Msaada?"
          >Need Help?</a
        >
      </p>
      <button class="language-toggle" onclick="toggleLanguage()">
        Switch to Swahili
      </button>

      <aside class="tips-sidebar">
        <h4
          data-en="Password Reset Tips"
          data-sw="Vidokezo vya Kuweka Upya Nenosiri"
        >
          Password Reset Tips
        </h4>
        <ul>
          <li
            data-en="Use the email or phone number associated with your account."
            data-sw="Tumia barua pepe au nambari ya simu inayohusishwa na akaunti yako."
          ></li>
          <li
            data-en="Check your email or SMS for the reset link."
            data-sw="Angalia barua pepe au SMS yako kwa kiungo cha kuweka upya."
          ></li>
          <li
            data-en="Contact support if you encounter issues."
            data-sw="Wasiliana na usaidizi ikiwa unapata matatizo."
          ></li>
        </ul>
      </aside>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function toggleLanguage() {
        const select = document.getElementById("language") || { value: "en" };
        const elements = document.querySelectorAll("[data-en][data-sw]");
        const isSwahili = select.value === "en";
        select.value = isSwahili ? "sw" : "en";
        elements.forEach((element) => {
          element.textContent = isSwahili
            ? element.getAttribute("data-sw")
            : element.getAttribute("data-en");
        });
      }

      document
        .getElementById("forgotPasswordForm")
        .addEventListener("submit", function (event) {
          const identifier = document.getElementById("identifier").value;
          const identifierError = document.getElementById("identifierError");
          let isValid = true;

          // Validate email or phone number
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          const phoneRegex = /^\+254\d{9}$/;
          if (!emailRegex.test(identifier) && !phoneRegex.test(identifier)) {
            identifierError.style.display = "block";
            isValid = false;
          } else {
            identifierError.style.display = "none";
          }

          if (!isValid) {
            event.preventDefault();
            console.log("Form submission prevented due to validation errors");
          } else {
            console.log("Form validation passed, submitting...");
          }
        });
    </script>
  </body>
</html>
{% endblock %}
