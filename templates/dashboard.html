{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<h1>Welcome to the Housing Dashboard</h1>

<!-- Search Bar -->
<form method="GET" action="/search">
  <input type="text" name="query" placeholder="Search houses...">
  <button type="submit">Search</button>
</form>

<!-- House Listings -->
<section class="house-list">
  {% for house in houses %}
    <div class="house-card">
      <h3>{{ house.title }}</h3>
      <p>{{ house.description }}</p>
      <p><strong>Category:</strong> {{ house.category }}</p>
      <p><strong>Location:</strong> {{ house.location }}</p>
      <div class="images">
        {% for url in house.image_urls.split(',') %}
          <img src="{{ url }}" alt="House Image">
        {% endfor %}
      </div>
      <a href="/book/{{ house.id }}">Book</a>
      <form method="POST" action="/favorite/{{ house.id }}">
        <button type="submit">Add to Favorites</button>
      </form>
    </div>
  {% endfor %}
</section>

<!-- Google Map Integration -->
<section id="map" style="width:100%;height:400px;"></section>

<script>
  function initMap() {
    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 10,
      center: { lat: -1.2921, lng: 36.8219 } // Nairobi as default
    });

    const houses = {{ houses | tojson }};
    houses.forEach(house => {
      new google.maps.Marker({
        position: { lat: house.lat, lng: house.lng },
        map,
        title: house.title
      });
    });
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ config.GOOGLE_MAPS_API_KEY }}&callback=initMap" async defer></script>

{% endblock %}

  <script src="scripts/dashboard.js"></script>
</body>
</html>
