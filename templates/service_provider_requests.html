{% extends "base.html" %} {% block title %}My Service Requests - HomeHub{%
endblock %} {% block content %}

<style>
  :root {
    --primary: #4361ee;
    --primary-dark: #3a0ca3;
    --secondary: #7209b7;
    --accent: #f72585;
    --light: #f8f9fa;
    --dark: #212529;
    --success: #06ffa5;
    --info: #00b4d8;
    --warning: #ffbe0b;
    --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
  }

  body {
    font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
      sans-serif;
    background-color: #f8f9fa;
    color: var(--dark);
    line-height: 1.6;
  }

  .requests-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
  }

  /* Header Section */
  .requests-header {
    background: linear-gradient(
      135deg,
      var(--primary) 0%,
      var(--primary-dark) 100%
    );
    color: white;
    padding: 3rem 2rem;
    border-radius: 20px;
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
  }

  .requests-header::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,133.3C960,128,1056,96,1152,90.7C1248,85,1344,107,1392,117.3L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>')
      no-repeat bottom;
    background-size: cover;
  }

  .header-content {
    position: relative;
    z-index: 1;
  }

  .header-title {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 1rem;
  }

  .header-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    max-width: 700px;
  }

  /* Stats Section */
  .stats-section {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    transition: var(--transition);
  }

  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
  }

  .stat-icon {
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
    margin-right: 1.5rem;
    font-size: 1.5rem;
    color: white;
  }

  .pending-icon {
    background: linear-gradient(135deg, var(--warning), #ff9f1c);
  }
  .accepted-icon {
    background: linear-gradient(135deg, var(--success), #00b4d8);
  }
  .completed-icon {
    background: linear-gradient(135deg, var(--info), #0077b6);
  }
  .rejected-icon {
    background: linear-gradient(135deg, var(--accent), #e63946);
  }

  .stat-content h3 {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
  }

  .stat-content p {
    color: #6c757d;
    margin: 0;
  }

  /* Filters Section */
  .filters-section {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow);
  }

  .filters-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .filters-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--dark);
  }

  .filters-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-group label {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--dark);
  }

  .form-control,
  .form-select {
    padding: 0.75rem 1rem;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    font-size: 1rem;
    transition: var(--transition);
  }

  .form-control:focus,
  .form-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
  }

  .btn-filter {
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    align-self: flex-end;
  }

  .btn-filter:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
  }

  /* Requests Section */
  .requests-section {
    margin-bottom: 2rem;
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dark);
  }

  .view-toggle {
    display: flex;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: var(--shadow);
  }

  .view-btn {
    padding: 0.5rem 1rem;
    background: transparent;
    border: none;
    cursor: pointer;
    transition: var(--transition);
  }

  .view-btn.active {
    background: var(--primary);
    color: white;
  }

  /* Request Cards */
  .requests-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
  }

  .request-card {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: var(--transition);
    display: flex;
    flex-direction: column;
  }

  .request-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
  }

  .request-header {
    padding: 1.5rem;
    border-bottom: 1px solid #e9ecef;
  }

  .request-id {
    font-size: 0.85rem;
    color: #6c757d;
    margin-bottom: 0.5rem;
  }

  .request-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 0.5rem;
  }

  .request-property {
    display: flex;
    align-items: center;
    color: #6c757d;
    font-size: 0.95rem;
  }

  .request-property i {
    color: var(--primary);
    margin-right: 0.5rem;
  }

  .request-body {
    padding: 1.5rem;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }

  .request-description {
    color: #495057;
    margin-bottom: 1.5rem;
    flex-grow: 1;
  }

  .request-meta {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .meta-item {
    display: flex;
    flex-direction: column;
  }

  .meta-label {
    font-size: 0.85rem;
    color: #6c757d;
    margin-bottom: 0.25rem;
  }

  .meta-value {
    font-weight: 600;
    color: var(--dark);
  }

  .request-status {
    display: inline-block;
    padding: 0.4rem 1rem;
    border-radius: 50px;
    font-weight: 600;
    font-size: 0.85rem;
    margin-bottom: 1rem;
  }

  .status-pending {
    background: rgba(255, 190, 11, 0.15);
    color: var(--warning);
  }

  .status-accepted {
    background: rgba(6, 255, 165, 0.15);
    color: var(--success);
  }

  .status-completed {
    background: rgba(0, 180, 216, 0.15);
    color: var(--info);
  }

  .status-rejected {
    background: rgba(247, 37, 133, 0.15);
    color: var(--accent);
  }

  .request-actions {
    display: flex;
    gap: 0.75rem;
  }

  .btn-action {
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
    border: none;
    font-size: 0.9rem;
    flex: 1;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
  }

  .btn-outline {
    background: transparent;
    color: var(--primary);
    border: 2px solid var(--primary);
  }

  .btn-outline:hover {
    background: var(--primary);
    color: white;
  }

  .btn-success {
    background: linear-gradient(135deg, var(--success), #00b4d8);
    color: white;
  }

  .btn-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(6, 255, 165, 0.3);
  }

  /* List View */
  .requests-list {
    display: none;
  }

  .requests-list.active {
    display: block;
  }

  .list-item {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    box-shadow: var(--shadow);
    transition: var(--transition);
  }

  .list-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  }

  .list-content {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr auto;
    gap: 1.5rem;
    align-items: center;
  }

  .list-info h3 {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 0.5rem;
  }

  .list-property {
    display: flex;
    align-items: center;
    color: #6c757d;
    font-size: 0.95rem;
  }

  .list-property i {
    color: var(--primary);
    margin-right: 0.5rem;
  }

  .list-meta {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .list-actions {
    display: flex;
    gap: 0.75rem;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 15px;
    box-shadow: var(--shadow);
  }

  .empty-icon {
    font-size: 4rem;
    color: #dee2e6;
    margin-bottom: 1rem;
  }

  .empty-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 1rem;
  }

  .empty-description {
    color: #6c757d;
    max-width: 500px;
    margin: 0 auto 2rem;
  }

  /* Responsive */
  @media (max-width: 992px) {
    .requests-grid {
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    }

    .list-content {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .list-actions {
      justify-content: flex-start;
    }
  }

  @media (max-width: 768px) {
    .requests-container {
      padding: 1rem;
    }

    .header-title {
      font-size: 2rem;
    }

    .filters-form {
      grid-template-columns: 1fr;
    }

    .requests-grid {
      grid-template-columns: 1fr;
    }

    .section-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }
  }
</style>
<div class="requests-container">
  <!-- Header Section -->
  <div class="requests-header">
    <div class="header-content">
      <h1 class="header-title">My Service Requests</h1>
      <p class="header-subtitle">
        Track and manage all your maintenance job bids and requests in one place
      </p>
    </div>
  </div>

  <!-- Stats Section -->
  <div class="stats-section">
    <div class="stat-card">
      <div class="stat-icon pending-icon">
        <i class="fas fa-clock"></i>
      </div>
      <div class="stat-content">
        <h3>{{ pending_count or 0 }}</h3>
        <p>Pending Requests</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon accepted-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ accepted_count or 0 }}</h3>
        <p>Accepted Requests</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon completed-icon">
        <i class="fas fa-tasks"></i>
      </div>
      <div class="stat-content">
        <h3>{{ completed_count or 0 }}</h3>
        <p>Completed Jobs</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon rejected-icon">
        <i class="fas fa-times-circle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ rejected_count or 0 }}</h3>
        <p>Rejected Requests</p>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-header">
      <h2 class="filters-title">Filter Requests</h2>
    </div>

    <form class="filters-form">
      <div class="form-group">
        <label for="status-filter">Status</label>
        <select id="status-filter" class="form-select">
          <option value="">All Statuses</option>
          <option value="pending">Pending</option>
          <option value="accepted">Accepted</option>
          <option value="completed">Completed</option>
          <option value="rejected">Rejected</option>
        </select>
      </div>

      <div class="form-group">
        <label for="date-filter">Date Range</label>
        <select id="date-filter" class="form-select">
          <option value="">All Time</option>
          <option value="today">Today</option>
          <option value="week">This Week</option>
          <option value="month">This Month</option>
          <option value="year">This Year</option>
        </select>
      </div>

      <div class="form-group">
        <label for="property-filter">Property</label>
        <select id="property-filter" class="form-select">
          <option value="">All Properties</option>
          {% for property in properties %}
          <option value="{{ property.id }}">{{ property.title }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label for="search-filter">Search</label>
        <input
          type="text"
          id="search-filter"
          class="form-control"
          placeholder="Search requests..."
        />
      </div>

      <button type="button" class="btn-filter">Apply Filters</button>
    </form>
  </div>

  <!-- Requests Section -->
  <div class="requests-section">
    <div class="section-header">
      <h2 class="section-title">Your Requests</h2>

      <div class="view-toggle">
        <button class="view-btn active" id="grid-view">
          <i class="fas fa-th"></i>
        </button>
        <button class="view-btn" id="list-view">
          <i class="fas fa-list"></i>
        </button>
      </div>
    </div>

    {% if requests %}
    <!-- Grid View -->
    <div class="requests-grid" id="grid-view-container">
      {% for request in requests %}
      <div class="request-card" data-status="{{ request.status }}">
        <div class="request-header">
          <div class="request-id">Request #{{ request.id }}</div>
          <h3 class="request-title">{{ request.title }}</h3>
          <div class="request-property">
            <i class="fas fa-map-marker-alt"></i>
            <span
              >{{ request.property.title }}, {{ request.property.location
              }}</span
            >
          </div>
        </div>

        <div class="request-body">
          <p class="request-description">{{ request.description }}</p>

          <div class="request-meta">
            <div class="meta-item">
              <div class="meta-label">Bid Amount</div>
              <div class="meta-value">KES {{ request.bid_amount }}</div>
            </div>

            <div class="meta-item">
              <div class="meta-label">Submitted</div>
              <div class="meta-value">
                {{ request.created_at.strftime('%d %b %Y') }}
              </div>
            </div>

            <div class="meta-item">
              <div class="meta-label">Est. Duration</div>
              <div class="meta-value">
                {{ request.estimated_duration }} days
              </div>
            </div>

            <div class="meta-item">
              <div class="meta-label">Last Updated</div>
              <div class="meta-value">
                {{ request.updated_at.strftime('%d %b %Y') }}
              </div>
            </div>
          </div>

          <div class="request-status status-{{ request.status }}">
            {{ request.status.title() }}
          </div>

          <div class="request-actions">
            <a
              href="{{ url_for('service_provider.view_request', request_id=request.id) }}"
              class="btn-action btn-primary"
            >
              <i class="fas fa-eye"></i> View Details
            </a>

            {% if request.status == 'accepted' %}
            <button
              class="btn-action btn-success"
              onclick="markAsCompleted({{ request.id }})"
            >
              <i class="fas fa-check"></i> Mark Complete
            </button>
            {% endif %} {% if request.status == 'pending' %}
            <button
              class="btn-action btn-outline"
              onclick="withdrawRequest({{ request.id }})"
            >
              <i class="fas fa-times"></i> Withdraw
            </button>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- List View -->
    <div class="requests-list" id="list-view-container">
      {% for request in requests %}
      <div class="list-item" data-status="{{ request.status }}">
        <div class="list-content">
          <div class="list-info">
            <h3>{{ request.title }}</h3>
            <div class="list-property">
              <i class="fas fa-map-marker-alt"></i>
              <span
                >{{ request.property.title }}, {{ request.property.location
                }}</span
              >
            </div>
          </div>

          <div class="list-meta">
            <div>
              <div class="meta-label">Bid Amount</div>
              <div class="meta-value">KES {{ request.bid_amount }}</div>
            </div>
            <div>
              <div class="meta-label">Submitted</div>
              <div class="meta-value">
                {{ request.created_at.strftime('%d %b %Y') }}
              </div>
            </div>
          </div>

          <div class="list-status">
            <div class="request-status status-{{ request.status }}">
              {{ request.status.title() }}
            </div>
            <div class="list-actions">
              <a
                href="{{ url_for('service_provider.view_request', request_id=request.id) }}"
                class="btn-action btn-primary"
              >
                <i class="fas fa-eye"></i> View
              </a>

              {% if request.status == 'accepted' %}
              <button
                class="btn-action btn-success"
                onclick="markAsCompleted({{ request.id }})"
              >
                <i class="fas fa-check"></i> Complete
              </button>
              {% endif %} {% if request.status == 'pending' %}
              <button
                class="btn-action btn-outline"
                onclick="withdrawRequest({{ request.id }})"
              >
                <i class="fas fa-times"></i> Withdraw
              </button>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="empty-state">
      <div class="empty-icon">
        <i class="fas fa-clipboard-list"></i>
      </div>
      <h3 class="empty-title">No Service Requests Found</h3>
      <p class="empty-description">
        You haven't placed any service requests yet. Browse available
        maintenance jobs and submit your bids to get started.
      </p>
      <a
        href="{{ url_for('service_provider.browse_jobs') }}"
        class="btn btn-primary"
      >
        <i class="fas fa-search"></i> Browse Jobs
      </a>
    </div>
    {% endif %}
  </div>
</div>

<!-- Mark as Completed Modal -->
<div
  class="modal fade"
  id="completeModal"
  tabindex="-1"
  aria-labelledby="completeModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="completeModalLabel">
          Mark Job as Completed
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <p>
          Are you sure you want to mark this job as completed? This action
          cannot be undone.
        </p>
        <form id="complete-form">
          <div class="mb-3">
            <label for="completion-notes" class="form-label"
              >Completion Notes (Optional)</label
            >
            <textarea
              class="form-control"
              id="completion-notes"
              rows="3"
              placeholder="Add any notes about the completion of this job..."
            ></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button type="button" class="btn btn-primary" id="confirm-complete">
          Mark as Completed
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Withdraw Request Modal -->
<div
  class="modal fade"
  id="withdrawModal"
  tabindex="-1"
  aria-labelledby="withdrawModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="withdrawModalLabel">Withdraw Request</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <p>
          Are you sure you want to withdraw this request? This action cannot be
          undone.
        </p>
        <form id="withdraw-form">
          <div class="mb-3">
            <label for="withdraw-reason" class="form-label"
              >Reason (Optional)</label
            >
            <textarea
              class="form-control"
              id="withdraw-reason"
              rows="3"
              placeholder="Please provide a reason for withdrawing this request..."
            ></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button type="button" class="btn btn-danger" id="confirm-withdraw">
          Withdraw Request
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // View Toggle
    const gridViewBtn = document.getElementById("grid-view");
    const listViewBtn = document.getElementById("list-view");
    const gridViewContainer = document.getElementById("grid-view-container");
    const listViewContainer = document.getElementById("list-view-container");

    gridViewBtn.addEventListener("click", function () {
      gridViewBtn.classList.add("active");
      listViewBtn.classList.remove("active");
      gridViewContainer.style.display = "grid";
      listViewContainer.classList.remove("active");
    });

    listViewBtn.addEventListener("click", function () {
      listViewBtn.classList.add("active");
      gridViewBtn.classList.remove("active");
      listViewContainer.classList.add("active");
      gridViewContainer.style.display = "none";
    });

    // Mark as Completed
    let currentRequestId = null;

    function markAsCompleted(requestId) {
      currentRequestId = requestId;
      const modal = new bootstrap.Modal(
        document.getElementById("completeModal")
      );
      modal.show();
    }

    document
      .getElementById("confirm-complete")
      .addEventListener("click", function () {
        const notes = document.getElementById("completion-notes").value;

        // Here you would normally send the data to your server
        // For demo purposes, we'll just show a success message
        alert(`Request #${currentRequestId} has been marked as completed.`);

        // Close the modal
        const modal = bootstrap.Modal.getInstance(
          document.getElementById("completeModal")
        );
        modal.hide();

        // Reset the form
        document.getElementById("complete-form").reset();

        // Reload the page to show updated status
        location.reload();
      });

    // Withdraw Request
    function withdrawRequest(requestId) {
      currentRequestId = requestId;
      const modal = new bootstrap.Modal(
        document.getElementById("withdrawModal")
      );
      modal.show();
    }

    document
      .getElementById("confirm-withdraw")
      .addEventListener("click", function () {
        const reason = document.getElementById("withdraw-reason").value;

        // Here you would normally send the data to your server
        // For demo purposes, we'll just show a success message
        alert(`Request #${currentRequestId} has been withdrawn.`);

        // Close the modal
        const modal = bootstrap.Modal.getInstance(
          document.getElementById("withdrawModal")
        );
        modal.hide();

        // Reset the form
        document.getElementById("withdraw-form").reset();

        // Reload the page to show updated status
        location.reload();
      });

    // Filter functionality
    const statusFilter = document.getElementById("status-filter");
    const dateFilter = document.getElementById("date-filter");
    const propertyFilter = document.getElementById("property-filter");
    const searchFilter = document.getElementById("search-filter");
    const filterBtn = document.querySelector(".btn-filter");

    filterBtn.addEventListener("click", function () {
      const status = statusFilter.value;
      const date = dateFilter.value;
      const property = propertyFilter.value;
      const search = searchFilter.value.toLowerCase();

      // Get all request cards
      const requestCards = document.querySelectorAll(".request-card");
      const listItems = document.querySelectorAll(".list-item");

      // Filter grid view
      requestCards.forEach((card) => {
        const cardStatus = card.getAttribute("data-status");
        const cardTitle = card
          .querySelector(".request-title")
          .textContent.toLowerCase();
        const cardProperty = card
          .querySelector(".request-property span")
          .textContent.toLowerCase();

        let showCard = true;

        if (status && cardStatus !== status) showCard = false;
        if (
          search &&
          !cardTitle.includes(search) &&
          !cardProperty.includes(search)
        )
          showCard = false;

        card.style.display = showCard ? "flex" : "none";
      });

      // Filter list view
      listItems.forEach((item) => {
        const itemStatus = item.getAttribute("data-status");
        const itemTitle = item
          .querySelector(".list-info h3")
          .textContent.toLowerCase();
        const itemProperty = item
          .querySelector(".list-property span")
          .textContent.toLowerCase();

        let showItem = true;

        if (status && itemStatus !== status) showItem = false;
        if (search && !itemTitle.includes(search) && !Property.includes(search))
          showItem = false;

        item.style.display = showItem ? "block" : "none";
      });
    });
  });
</script>
{% endblock %}
