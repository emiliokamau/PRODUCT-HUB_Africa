{% extends "base.html" %} {% block title %}Landlord Dashboard - HomeHub{%
endblock %} {% block head %}
<style>
  :root {
    --primary-color: #3d8b40;
    --secondary-color: #4a90e2;
    --accent-color: #f28c38;
    --dark-color: #1a1a1a;
    --light-color: #f5f5f5;
    --white-color: #ffffff;
    --success-color: #4caf50;
    --warning-color: #ffc107;
    --danger-color: #f44336;
    --info-color: #2196f3;
    --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
    --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
    --border-radius: 8px;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--light-color);
    color: var(--dark-color);
    line-height: 1.6;
  }

  /* Main Content */
  main {
    transition: margin-left 0.3s ease;
  }

  main.shifted {
    margin-left: 250px;
  }

  /* Top Bar */
  .top-bar {
    background-color: var(--white-color);
    border-radius: var(--border-radius);
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    box-shadow: var(--shadow-sm);
  }

  .menu-toggle {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--dark-color);
    cursor: pointer;
  }

  .top-bar-right {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .notification-icon {
    position: relative;
    font-size: 1.2rem;
    color: var(--dark-color);
    cursor: pointer;
  }

  .notification-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background-color: var(--danger-color);
    color: var(--white-color);
    font-size: 0.7rem;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .user-profile {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
  }

  .user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
  }

  .user-info h4 {
    font-size: 0.9rem;
    font-weight: 600;
  }

  .user-info p {
    font-size: 0.8rem;
    color: #666;
  }

  /* Dashboard Content */
  .dashboard-container {
    background-color: var(--white-color);
    border-radius: var(--border-radius);
    padding: 25px;
    box-shadow: var(--shadow-sm);
    margin-bottom: 20px;
  }

  .dashboard-header {
    margin-bottom: 25px;
  }

  .dashboard-title {
    font-size: 1.8rem;
    margin-bottom: 5px;
    color: var(--dark-color);
  }

  .dashboard-subtitle {
    color: #666;
    font-size: 1rem;
  }

  /* Alert Styles */
  .alert {
    padding: 15px 20px;
    border-radius: var(--border-radius);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .alert-success {
    background-color: rgba(76, 175, 80, 0.1);
    color: var(--success-color);
    border-left: 4px solid var(--success-color);
  }

  .alert-danger {
    background-color: rgba(244, 67, 54, 0.1);
    color: var(--danger-color);
    border-left: 4px solid var(--danger-color);
  }

  .alert-info {
    background-color: rgba(33, 150, 243, 0.1);
    color: var(--info-color);
    border-left: 4px solid var(--info-color);
  }

  .alert-warning {
    background-color: rgba(255, 193, 7, 0.1);
    color: var(--warning-color);
    border-left: 4px solid var(--warning-color);
  }

  .alert-close {
    margin-left: auto;
    background: none;
    border: none;
    font-size: 1.2rem;
    cursor: pointer;
    opacity: 0.7;
  }

  .alert-close:hover {
    opacity: 1;
  }

  /* Stats Cards */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .stat-card {
    background-color: var(--white-color);
    border-radius: var(--border-radius);
    padding: 20px;
    box-shadow: var(--shadow-sm);
    display: flex;
    align-items: center;
    gap: 15px;
    transition: var(--transition);
    border-left: 4px solid transparent;
  }

  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-md);
  }

  .stat-card.properties {
    border-left-color: var(--primary-color);
  }

  .stat-card.occupancy {
    border-left-color: var(--secondary-color);
  }

  .stat-card.revenue {
    border-left-color: var(--success-color);
  }

  .stat-card.maintenance {
    border-left-color: var(--warning-color);
  }

  .stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
  }

  .stat-card.properties .stat-icon {
    background-color: rgba(61, 139, 64, 0.1);
    color: var(--primary-color);
  }

  .stat-card.occupancy .stat-icon {
    background-color: rgba(74, 144, 226, 0.1);
    color: var(--secondary-color);
  }

  .stat-card.revenue .stat-icon {
    background-color: rgba(76, 175, 80, 0.1);
    color: var(--success-color);
  }

  .stat-card.maintenance .stat-icon {
    background-color: rgba(255, 193, 7, 0.1);
    color: var(--warning-color);
  }

  .stat-content h3 {
    font-size: 0.9rem;
    font-weight: 600;
    color: #666;
    margin-bottom: 5px;
  }

  .stat-value {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--dark-color);
  }

  /* Content Cards */
  .content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .content-card {
    background-color: var(--white-color);
    border-radius: var(--border-radius);
    padding: 20px;
    box-shadow: var(--shadow-sm);
    transition: var(--transition);
  }

  .content-card:hover {
    box-shadow: var(--shadow-md);
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
  }

  .card-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--dark-color);
  }

  .card-action {
    font-size: 0.9rem;
    color: var(--secondary-color);
    font-weight: 500;
  }

  .card-body {
    color: #666;
  }

  /* Property List */
  .property-item {
    padding: 15px;
    border-radius: var(--border-radius);
    background-color: var(--light-color);
    margin-bottom: 15px;
    transition: var(--transition);
  }

  .property-item:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-sm);
  }

  .property-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 10px;
  }

  .property-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--dark-color);
    margin-bottom: 5px;
  }

  .property-address {
    font-size: 0.9rem;
    color: #666;
    margin-bottom: 10px;
  }

  .property-details {
    display: flex;
    gap: 15px;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }

  .property-detail {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.9rem;
    color: #555;
  }

  .property-detail i {
    color: var(--primary-color);
  }

  .property-status {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
  }

  .status-occupied {
    background-color: rgba(76, 175, 80, 0.1);
    color: var(--success-color);
  }

  .status-vacant {
    background-color: rgba(244, 67, 54, 0.1);
    color: var(--danger-color);
  }

  .property-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
  }

  /* Tables */
  .table-container {
    overflow-x: auto;
    margin-bottom: 20px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  th,
  td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #eee;
  }

  th {
    background-color: var(--light-color);
    font-weight: 600;
    color: var(--dark-color);
  }

  tr:hover {
    background-color: rgba(0, 0, 0, 0.02);
  }

  /* Buttons */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 10px 16px;
    border-radius: var(--border-radius);
    font-weight: 500;
    text-decoration: none;
    border: none;
    cursor: pointer;
    transition: var(--transition);
    font-size: 0.9rem;
    gap: 6px;
  }

  .btn i {
    font-size: 1rem;
  }

  .btn-primary {
    background-color: var(--primary-color);
    color: var(--white-color);
  }

  .btn-primary:hover {
    background-color: #327334;
  }

  .btn-secondary {
    background-color: var(--secondary-color);
    color: var(--white-color);
  }

  .btn-secondary:hover {
    background-color: #3a7bc8;
  }

  .btn-success {
    background-color: var(--success-color);
    color: var(--white-color);
  }

  .btn-success:hover {
    background-color: #3d8b40;
  }

  .btn-danger {
    background-color: var(--danger-color);
    color: var(--white-color);
  }

  .btn-danger:hover {
    background-color: #d32f2f;
  }

  .btn-outline {
    background-color: transparent;
    border: 1px solid var(--primary-color);
    color: var(--primary-color);
  }

  .btn-outline:hover {
    background-color: var(--primary-color);
    color: var(--white-color);
  }

  .btn-sm {
    padding: 6px 12px;
    font-size: 0.8rem;
  }

  .btn-block {
    display: block;
    width: 100%;
  }

  /* Forms */
  .form-group {
    margin-bottom: 15px;
  }

  .form-control {
    width: 100%;
    padding: 10px 15px;
    border: 1px solid #ddd;
    border-radius: var(--border-radius);
    font-size: 0.9rem;
    transition: var(--transition);
  }

  .form-control:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(61, 139, 64, 0.2);
  }

  /* Map */
  .map-container {
    height: 300px;
    border-radius: var(--border-radius);
    overflow: hidden;
    margin-bottom: 30px;
    box-shadow: var(--shadow-md);
  }

  /* Chat Widget */
  .chat-widget {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
  }

  .chat-toggle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: var(--primary-color);
    color: var(--white-color);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    cursor: pointer;
    box-shadow: var(--shadow-lg);
    transition: var(--transition);
  }

  .chat-toggle:hover {
    background-color: #327334;
    transform: scale(1.05);
  }

  .chat-box {
    position: absolute;
    bottom: 80px;
    right: 0;
    width: 350px;
    height: 450px;
    background-color: var(--white-color);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-lg);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    opacity: 0;
    transform: translateY(20px);
    visibility: hidden;
    transition: var(--transition);
  }

  .chat-box.active {
    opacity: 1;
    transform: translateY(0);
    visibility: visible;
  }

  .chat-header {
    background-color: var(--primary-color);
    color: var(--white-color);
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .chat-header h4 {
    margin: 0;
  }

  .chat-close {
    background: none;
    border: none;
    color: var(--white-color);
    font-size: 1.2rem;
    cursor: pointer;
  }

  .chat-body {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    background-color: #f9f9f9;
  }

  .chat-message {
    margin-bottom: 15px;
    display: flex;
  }

  .chat-message.sent {
    justify-content: flex-end;
  }

  .chat-bubble {
    max-width: 80%;
    padding: 10px 15px;
    border-radius: var(--border-radius);
    word-wrap: break-word;
  }

  .chat-message.sent .chat-bubble {
    background-color: var(--primary-color);
    color: var(--white-color);
  }

  .chat-message.received .chat-bubble {
    background-color: var(--white-color);
    color: var(--dark-color);
    box-shadow: var(--shadow-sm);
  }

  .chat-footer {
    padding: 15px;
    border-top: 1px solid #eee;
    display: flex;
    gap: 10px;
  }

  .chat-input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: var(--border-radius);
    font-size: 0.9rem;
  }

  .chat-send {
    padding: 10px 15px;
    background-color: var(--primary-color);
    color: var(--white-color);
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
  }

  /* Footer */
  .dashboard-footer {
    text-align: center;
    padding: 20px;
    color: #666;
    font-size: 0.9rem;
  }

  .dashboard-footer a {
    color: var(--secondary-color);
    font-weight: 500;
  }

  /* Responsive Styles */
  @media (max-width: 992px) {
    .content-grid {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }
  }

  @media (max-width: 768px) {
    .menu-toggle {
      display: block;
    }

    .stats-grid {
      grid-template-columns: 1fr;
    }

    .content-grid {
      grid-template-columns: 1fr;
    }

    .chat-box {
      width: 90vw;
      right: 5vw;
    }

    .user-info {
      display: none;
    }
  }

  @media (max-width: 576px) {
    .dashboard-header {
      text-align: center;
    }

    .top-bar {
      padding: 10px 15px;
    }

    .dashboard-container {
      padding: 15px;
    }

    .property-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }

    .property-actions {
      flex-direction: column;
      width: 100%;
    }

    .property-actions .btn {
      width: 100%;
    }
  }
</style>
{% endblock %} {% block content %}
<!-- Main Content -->
<main class="container my-4" id="main">
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="top-bar-left">
      <button class="menu-toggle" id="menuToggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
    </div>

    <div class="top-bar-right">
      <div class="notification-icon">
        <i class="fas fa-bell"></i>
        {% if notifications %}
        <span class="notification-badge">{{ notifications|length }}</span>
        {% endif %}
      </div>

      <div class="user-profile">
        <img
          src="{{ url_for('static', filename='images/user-avatar.jpg') }}"
          alt="User Avatar"
          class="user-avatar"
        />
        <div class="user-info">
          <h4>{{ current_user.name }}</h4>
          <p>Landlord</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %} {% if
  messages %} {% for category, message in messages %}
  <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }}">
    <i
      class="fas fa-{{ 'exclamation-circle' if category == 'error' else 'check-circle' }}"
    ></i>
    <span>{{ message }}</span>
    <button class="alert-close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  {% endfor %} {% endif %} {% endwith %}

  <!-- Dashboard Container -->
  <div class="dashboard-container">
    <div class="dashboard-header">
      <h1 class="dashboard-title">Landlord Dashboard</h1>
      <p class="dashboard-subtitle">
        Welcome back, {{ current_user.name }}! Here's what's happening with your
        properties.
      </p>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card properties">
        <div class="stat-icon">
          <i class="fas fa-building"></i>
        </div>
        <div class="stat-content">
          <h3>Total Properties</h3>
          <div class="stat-value">{{ stats.total_properties }}</div>
        </div>
      </div>

      <div class="stat-card occupancy">
        <div class="stat-icon">
          <i class="fas fa-percentage"></i>
        </div>
        <div class="stat-content">
          <h3>Occupancy Rate</h3>
          <div class="stat-value">{{ stats.occupancy_rate }}%</div>
        </div>
      </div>

      <div class="stat-card revenue">
        <div class="stat-icon">
          <i class="fas fa-money-bill-wave"></i>
        </div>
        <div class="stat-content">
          <h3>Monthly Revenue</h3>
          <div class="stat-value">KES {{ stats.monthly_revenue }}</div>
        </div>
      </div>

      <div class="stat-card maintenance">
        <div class="stat-icon">
          <i class="fas fa-tools"></i>
        </div>
        <div class="stat-content">
          <h3>Pending Requests</h3>
          <div class="stat-value">{{ maintenance_requests|length }}</div>
        </div>
      </div>
    </div>

    <!-- Map Section -->
    <div class="map-container">
      <div id="map"></div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
      <!-- Properties Card -->
      <div class="content-card">
        <div class="card-header">
          <h3 class="card-title">Your Properties</h3>
          <a href="{{ url_for('landlord.properties') }}" class="card-action"
            >View All</a
          >
        </div>
        <div class="card-body">
          {% if houses %} {% for property in houses[:3] %}
          <div class="property-item">
            <div class="property-header">
              <div>
                <h4 class="property-title">{{ property.title }}</h4>
                <p class="property-address">{{ property.address }}</p>
              </div>
              <span
                class="property-status {% if property.tenant %}status-occupied{% else %}status-vacant{% endif %}"
              >
                {% if property.tenant %}Occupied{% else %}Vacant{% endif %}
              </span>
            </div>

            <div class="property-details">
              <div class="property-detail">
                <i class="fas fa-bed"></i> {{ property.bedrooms }} bed
              </div>
              <div class="property-detail">
                <i class="fas fa-bath"></i> {{ property.bathrooms }} bath
              </div>
              <div class="property-detail">
                <i class="fas fa-ruler-combined"></i> {{ property.size }} sqft
              </div>
            </div>

            <div class="property-actions">
              <a
                href="{{ url_for('landlord.edit_property', property_id=property.id) }}"
                class="btn btn-sm btn-outline"
              >
                <i class="fas fa-edit"></i> Edit
              </a>
              <button
                onclick="confirmDelete({{ property.id }})"
                class="btn btn-sm btn-danger"
              >
                <i class="fas fa-trash"></i> Delete
              </button>
            </div>
          </div>
          {% endfor %} {% else %}
          <p>No properties found. Add your first property to get started.</p>
          <a
            href="{{ url_for('landlord.add_property') }}"
            class="btn btn-primary btn-block"
          >
            <i class="fas fa-plus"></i> Add Property
          </a>
          {% endif %}
        </div>
      </div>

      <!-- Recent Payments Card -->
      <div class="content-card">
        <div class="card-header">
          <h3 class="card-title">Recent Payments</h3>
          <a href="{{ url_for('landlord.payments') }}" class="card-action"
            >View All</a
          >
        </div>
        <div class="card-body">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Tenant</th>
                  <th>Amount</th>
                  <th>Date</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for payment in recent_payments %}
                <tr>
                  <td>{{ payment.tenant_name }}</td>
                  <td>KES {{ payment.amount }}</td>
                  <td>{{ payment.date_paid }}</td>
                  <td>
                    <span
                      class="property-status {% if payment.status == 'Paid' %}status-occupied{% else %}status-vacant{% endif %}"
                    >
                      {{ payment.status }}
                    </span>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Tenants Card -->
      <div class="content-card">
        <div class="card-header">
          <h3 class="card-title">Recent Tenants</h3>
          <a href="{{ url_for('landlord.tenants') }}" class="card-action"
            >View All</a
          >
        </div>
        <div class="card-body">
          {% if tenants %} {% for tenant in tenants[:3] %}
          <div class="property-item">
            <div class="property-header">
              <div>
                <h4 class="property-title">{{ tenant.name }}</h4>
                <p class="property-address">{{ tenant.property.address }}</p>
              </div>
            </div>

            <div class="property-details">
              <div class="property-detail">
                <i class="fas fa-calendar-alt"></i> Lease ends: {{
                tenant.lease_end_date.strftime('%b %d, %Y') }}
              </div>
            </div>

            <div class="property-actions">
              <a
                href="{{ url_for('landlord.tenant_details', tenant_id=tenant.id) }}"
                class="btn btn-sm btn-outline"
              >
                <i class="fas fa-eye"></i> Details
              </a>
              <a
                href="{{ url_for('landlord.send_message', tenant_id=tenant.id) }}"
                class="btn btn-sm btn-primary"
              >
                <i class="fas fa-envelope"></i> Message
              </a>
            </div>
          </div>
          {% endfor %} {% else %}
          <p>No tenants found.</p>
          {% endif %}
        </div>
      </div>

      <!-- Maintenance Requests Card -->
      <div class="content-card">
        <div class="card-header">
          <h3 class="card-title">Maintenance Requests</h3>
          <a href="{{ url_for('landlord.maintenance') }}" class="card-action"
            >View All</a
          >
        </div>
        <div class="card-body">
          {% if maintenance_requests %} {% for request in
          maintenance_requests[:3] %}
          <div class="property-item">
            <div class="property-header">
              <div>
                <h4 class="property-title">{{ request.title }}</h4>
                <p class="property-address">{{ request.property.address }}</p>
              </div>
              <span class="property-status status-{{ request.status|lower }}">
                {{ request.status }}
              </span>
            </div>

            <div class="property-details">
              <div class="property-detail">
                <i class="fas fa-user"></i> {{ request.tenant_name }}
              </div>
              <div class="property-detail">
                <i class="fas fa-calendar-alt"></i> {{
                request.created_at.strftime('%b %d, %Y') }}
              </div>
            </div>

            <div class="property-actions">
              <a
                href="{{ url_for('landlord.maintenance_detail', request_id=request.id) }}"
                class="btn btn-sm btn-outline"
              >
                <i class="fas fa-eye"></i> Details
              </a>
            </div>
          </div>
          {% endfor %} {% else %}
          <p>No maintenance requests.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Footer Links -->
    <footer class="dashboard-footer">
      <a href="/terms">Terms of Service</a> |
      <a href="/privacy">Privacy Policy</a>
    </footer>
  </div>
</main>

<!-- Chat Widget -->
<div class="chat-widget">
  <div class="chat-toggle" onclick="toggleChat()">
    <i class="fas fa-comments"></i>
  </div>
  <div class="chat-box" id="chatBox">
    <div class="chat-header">
      <h4>Support Chat</h4>
      <button class="chat-close" onclick="toggleChat()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="chat-body" id="chatBody">
      <div class="chat-message received">
        <div class="chat-bubble">Hello! How can I help you today?</div>
      </div>
    </div>
    <div class="chat-footer">
      <input
        type="text"
        class="chat-input"
        id="chatInput"
        placeholder="Type a message..."
      />
      <button class="chat-send" onclick="sendChatMessage()">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCCGkhU-aZlUelsOQypH5jTjkf5lIRBL7Y&callback=initMap"
  async
  defer
></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Alert Close
    const alertCloseButtons = document.querySelectorAll('.alert-close');
    alertCloseButtons.forEach(button => {
      button.addEventListener('click', function() {
        this.parentElement.style.display = 'none';
      });
    });

    // Initialize Map
    initMap();

    // Initialize Chart
    const ctx = document.getElementById('revenueChart');
    if (ctx) {
      new Chart(ctx.getContext('2d'), {
        type: 'line',
        data: {
          labels: {{ chart_labels|tojson if chart_labels else '[]' }},
          datasets: [{
            label: 'Monthly Revenue',
            data: {{ chart_data|tojson if chart_data else '[]' }},
            backgroundColor: 'rgba(61, 139, 64, 0.2)',
            borderColor: 'rgba(61, 139, 64, 1)',
            borderWidth: 2,
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return 'KES ' + value;
                }
              }
            }
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return 'KES ' + context.raw;
                }
              }
            }
          }
        }
      });
    }
  });

  // Initialize Map
  function initMap() {
    const map = new google.maps.Map(document.getElementById('map'), {
      zoom: 12,
      center: { lat: -1.286389, lng: 36.817223 },
      styles: [
        {
          featureType: 'water',
          elementType: 'geometry',
          stylers: [{ color: '#e9e9e9' }, { lightness: 17 }]
        },
        {
          featureType: 'landscape',
          elementType: 'geometry',
          stylers: [{ color: '#f5f5f5' }, { lightness: 20 }]
        },
        {
          featureType: 'road.highway',
          elementType: 'geometry.fill',
          stylers: [{ color: '#ffffff' }, { lightness: 17 }]
        },
        {
          featureType: 'road.highway',
          elementType: 'geometry.stroke',
          stylers: [{ color: '#ffffff' }, { lightness: 29 }, { weight: 0.2 }]
        },
        {
          featureType: 'road.arterial',
          elementType: 'geometry',
          stylers: [{ color: '#ffffff' }, { lightness: 18 }]
        },
        {
          featureType: 'road.local',
          elementType: 'geometry',
          stylers: [{ color: '#ffffff' }, { lightness: 16 }]
        },
        {
          featureType: 'poi',
          elementType: 'geometry',
          stylers: [{ color: '#f5f5f5' }, { lightness: 21 }]
        },
        {
          featureType: 'poi.park',
          elementType: 'geometry',
          stylers: [{ color: '#dedede' }, { lightness: 21 }]
        },
        {
          elementType: 'labels.text.stroke',
          stylers: [{ visibility: 'on' }, { color: '#ffffff' }, { lightness: 16 }]
        },
        {
          elementType: 'labels.text.fill',
          stylers: [{ saturation: 36 }, { color: '#333333' }, { lightness: 40 }]
        },
        {
          elementType: 'labels.icon',
          stylers: [{ visibility: 'off' }]
        },
        {
          featureType: 'transit',
          elementType: 'geometry',
          stylers: [{ color: '#f2f2f2' }, { lightness: 19 }]
        },
        {
          featureType: 'administrative',
          elementType: 'geometry.fill',
          stylers: [{ color: '#fefefe' }, { lightness: 20 }]
        },
        {
          featureType: 'administrative',
          elementType: 'geometry.stroke',
          stylers: [{ color: '#fefefe' }, { lightness: 17 }, { weight: 1.2 }]
        }
      ]
    });

    // Add markers for properties
    {% for property in houses %}
      {% if property.lat and property.lng %}
        new google.maps.Marker({
          position: { lat: {{ property.lat }}, lng: {{ property.lng }} },
          map: map,
          title: "{{ property.title }}",
          icon: {
            url: "{{ url_for('static', filename='images/marker-icon.png') }}",
            scaledSize: new google.maps.Size(30, 30)
          }
        });
      {% endif %}
    {% endfor %}
  }

  // Toggle Chat
  function toggleChat() {
    const chatBox = document.getElementById('chatBox');
    chatBox.classList.toggle('active');
  }

  // Send Chat Message
  function sendChatMessage() {
    const chatInput = document.getElementById('chatInput');
    const chatBody = document.getElementById('chatBody');
    const message = chatInput.value.trim();

    if (message) {
      // Add user message
      const userMessage = document.createElement('div');
      userMessage.className = 'chat-message sent';
      userMessage.innerHTML = `<div class="chat-bubble">${message}</div>`;
      chatBody.appendChild(userMessage);

      // Clear input
      chatInput.value = '';

      // Scroll to bottom
      chatBody.scrollTop = chatBody.scrollHeight;

      // Simulate response
      setTimeout(() => {
        const botMessage = document.createElement('div');
        botMessage.className = 'chat-message received';
        botMessage.innerHTML = `<div class="chat-bubble">Thank you for your message. Our support team will get back to you soon.</div>`;
        chatBody.appendChild(botMessage);
        chatBody.scrollTop = chatBody.scrollHeight;
      }, 1000);
    }
  }

  // Confirm Delete
  function confirmDelete(propertyId) {
    if (confirm('Are you sure you want to delete this property? This action cannot be undone.')) {
      fetch(`/landlord/delete_property/${propertyId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token() }}'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert('Error deleting property: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while deleting the property.');
      });
    }
  }

  // Handle Enter key in chat input
  document.getElementById('chatInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      sendChatMessage();
    }
  });
</script>
{% endblock %}
