{% extends 'base.html' %} 
{% block title %}Settings - HomeHub{% endblock %} 
{% block content %}

<style>
  :root {
    --primary: #4361ee;
    --primary-dark: #3a0ca3;
    --secondary: #7209b7;
    --accent: #f72585;
    --light: #f8f9fa;
    --dark: #212529;
    --success: #06ffa5;
    --info: #00b4d8;
    --warning: #ffbe0b;
    --danger: #e63946;
    --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
    --border-radius: 15px;
  }

  body {
    font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
      sans-serif;
    background-color: #f8f9fa;
    color: var(--dark);
    line-height: 1.6;
  }

  .settings-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
  }

  /* Header Section */
  .settings-header {
    background: linear-gradient(
      135deg,
      var(--primary) 0%,
      var(--primary-dark) 100%
    );
    color: white;
    padding: 3rem 2rem;
    border-radius: 20px;
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
  }

  .settings-header::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,133.3C960,128,1056,96,1152,90.7C1248,85,1344,107,1392,117.3L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>')
      no-repeat bottom;
    background-size: cover;
  }

  .header-content {
    position: relative;
    z-index: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }

  .header-title {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
  }

  .header-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
  }

  /* Navigation Tabs */
  .settings-nav {
    background: white;
    border-radius: var(--border-radius);
    padding: 1rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow);
    display: flex;
    gap: 1rem;
    overflow-x: auto;
  }

  .nav-tab {
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .nav-tab:hover {
    background: rgba(67, 97, 238, 0.1);
  }

  .nav-tab.active {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
  }

  .nav-tab i {
    font-size: 1.1rem;
  }

  /* Settings Content */
  .settings-content {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 2rem;
  }

  .settings-sidebar {
    background: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    box-shadow: var(--shadow);
    height: fit-content;
    position: sticky;
    top: 2rem;
  }

  .sidebar-menu {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .sidebar-item {
    margin-bottom: 0.5rem;
  }

  .sidebar-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 0.75rem 1rem;
    border-radius: 10px;
    color: var(--dark);
    text-decoration: none;
    transition: var(--transition);
    font-weight: 500;
  }

  .sidebar-link:hover {
    background: rgba(67, 97, 238, 0.1);
    color: var(--primary);
  }

  .sidebar-link.active {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
  }

  .sidebar-link i {
    width: 20px;
    text-align: center;
  }

  .settings-main {
    background: white;
    border-radius: var(--border-radius);
    padding: 2rem;
    box-shadow: var(--shadow);
  }

  /* Settings Sections */
  .settings-section {
    display: none;
  }

  .settings-section.active {
    display: block;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #f0f0f0;
  }

  .section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-title i {
    color: var(--primary);
  }

  /* Form Styles */
  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--dark);
  }

  .form-control {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    font-size: 1rem;
    transition: var(--transition);
  }

  .form-control:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
    outline: none;
  }

  .form-control.is-invalid {
    border-color: var(--danger);
  }

  .invalid-feedback {
    display: none;
    width: 100%;
    margin-top: 0.25rem;
    font-size: 0.875em;
    color: var(--danger);
  }

  .form-control.is-invalid ~ .invalid-feedback {
    display: block;
  }

  .form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
  }

  .form-text {
    font-size: 0.875rem;
    color: #6c757d;
    margin-top: 0.25rem;
  }

  /* Switch Toggle */
  .form-switch {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 10px;
    margin-bottom: 1rem;
  }

  .switch-label {
    font-weight: 500;
    color: var(--dark);
  }

  .switch-description {
    font-size: 0.875rem;
    color: #6c757d;
    margin-top: 0.25rem;
  }

  .switch-input {
    position: relative;
    width: 50px;
    height: 26px;
  }

  .switch-input input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .switch-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: var(--transition);
    border-radius: 34px;
  }

  .switch-slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: var(--transition);
    border-radius: 50%;
  }

  .switch-input input:checked + .switch-slider {
    background-color: var(--primary);
  }

  .switch-input input:checked + .switch-slider:before {
    transform: translateX(24px);
  }

  /* Buttons */
  .btn {
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    border: none;
    font-size: 1rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
  }

  .btn-success {
    background: linear-gradient(135deg, var(--success), #00b4d8);
    color: white;
  }

  .btn-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(6, 255, 165, 0.3);
  }

  .btn-danger {
    background: linear-gradient(135deg, var(--danger), #d63447);
    color: white;
  }

  .btn-danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(230, 57, 70, 0.3);
  }

  .btn-outline {
    background: transparent;
    color: var(--primary);
    border: 2px solid var(--primary);
  }

  .btn-outline:hover {
    background: var(--primary);
    color: white;
  }

  .btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
  }

  /* Alert Styles */
  .alert {
    padding: 1rem 1.5rem;
    border-radius: var(--border-radius);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .alert-success {
    background: linear-gradient(
      135deg,
      rgba(6, 255, 165, 0.1),
      rgba(0, 180, 216, 0.1)
    );
    color: var(--success);
    border-left: 5px solid var(--success);
  }

  .alert-danger {
    background: linear-gradient(
      135deg,
      rgba(247, 37, 133, 0.1),
      rgba(230, 57, 70, 0.1)
    );
    color: var(--danger);
    border-left: 5px solid var(--danger);
  }

  .alert-info {
    background: linear-gradient(
      135deg,
      rgba(0, 180, 216, 0.1),
      rgba(0, 119, 182, 0.1)
    );
    color: var(--info);
    border-left: 5px solid var(--info);
  }

  /* Table Styles */
  .table-container {
    overflow-x: auto;
    margin-bottom: 2rem;
  }

  .settings-table {
    width: 100%;
    border-collapse: collapse;
  }

  .settings-table th,
  .settings-table td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid #e9ecef;
  }

  .settings-table th {
    background-color: #f8f9fa;
    font-weight: 600;
    color: var(--dark);
  }

  .settings-table tr:hover {
    background-color: rgba(67, 97, 238, 0.05);
  }

  /* Notification Settings */
  .notification-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 10px;
    margin-bottom: 1rem;
  }

  .notification-info h5 {
    margin: 0 0 0.25rem 0;
    color: var(--dark);
  }

  .notification-info p {
    margin: 0;
    font-size: 0.875rem;
    color: #6c757d;
  }

  /* Security Info */
  .security-info {
    background: rgba(67, 97, 238, 0.05);
    border-left: 4px solid var(--primary);
    padding: 1rem;
    margin-bottom: 1.5rem;
    border-radius: 0 var(--border-radius) var(--border-radius) 0;
    font-size: 0.9rem;
    color: #495057;
  }

  .security-info i {
    color: var(--primary);
    margin-right: 0.5rem;
  }

  /* Connected Account */
  .connected-account {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 10px;
    margin-bottom: 1rem;
  }

  .account-info {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .account-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
  }

  .account-details h5 {
    margin: 0;
    color: var(--dark);
  }

  .account-details p {
    margin: 0;
    font-size: 0.875rem;
    color: #6c757d;
  }

  /* Toast Notification */
  .toast {
    position: fixed;
    top: 20px;
    right: 20px;
    min-width: 300px;
    padding: 1rem 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    z-index: 2000;
    display: flex;
    align-items: center;
    gap: 12px;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  .toast-success {
    background: linear-gradient(
      135deg,
      rgba(6, 255, 165, 0.9),
      rgba(0, 180, 216, 0.9)
    );
    color: white;
  }

  .toast-danger {
    background: linear-gradient(
      135deg,
      rgba(247, 37, 133, 0.9),
      rgba(230, 57, 70, 0.9)
    );
    color: white;
  }

  /* Responsive */
  @media (max-width: 992px) {
    .settings-content {
      grid-template-columns: 1fr;
    }

    .settings-sidebar {
      position: static;
      margin-bottom: 2rem;
    }
  }

  @media (max-width: 768px) {
    .settings-container {
      padding: 1rem;
    }

    .header-title {
      font-size: 2rem;
    }

    .settings-nav {
      flex-wrap: nowrap;
      overflow-x: auto;
    }

    .form-row {
      grid-template-columns: 1fr;
    }
  }
</style>

<div class="settings-container">
  <!-- Settings Header -->
  <div class="settings-header">
    <div class="header-content">
      <div>
        <h1 class="header-title">Settings</h1>
        <p class="header-subtitle">
          Manage your account settings and preferences
        </p>
      </div>
    </div>
  </div>

  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  {% for category, message in messages %}
  <div class="alert alert-{{ 'danger' if category == 'error' else category }}">
    <i class="fas fa-{{ 'exclamation-circle' if category == 'error' else 'check-circle' }}"></i>
    <span>{{ message }}</span>
  </div>
  {% endfor %}
  {% endif %}
  {% endwith %}

  <!-- Settings Navigation -->
  <div class="settings-nav">
    <div class="nav-tab active" onclick="showSection('general')">
      <i class="fas fa-cog"></i>
      General
    </div>
    <div class="nav-tab" onclick="showSection('notifications')">
      <i class="fas fa-bell"></i>
      Notifications
    </div>
    <div class="nav-tab" onclick="showSection('privacy')">
      <i class="fas fa-lock"></i>
      Privacy
    </div>
    <div class="nav-tab" onclick="showSection('security')">
      <i class="fas fa-shield-alt"></i>
      Security
    </div>
    <div class="nav-tab" onclick="showSection('billing')">
      <i class="fas fa-credit-card"></i>
      Billing
    </div>
    <div class="nav-tab" onclick="showSection('integrations')">
      <i class="fas fa-plug"></i>
      Integrations
    </div>
  </div>

  <!-- Settings Content -->
  <div class="settings-content">
    <!-- Sidebar -->
    <div class="settings-sidebar">
      <ul class="sidebar-menu">
        <li class="sidebar-item">
          <a href="#" class="sidebar-link active" onclick="showSection('general')">
            <i class="fas fa-cog"></i>
            General Settings
          </a>
        </li>
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" onclick="showSection('notifications')">
            <i class="fas fa-bell"></i>
            Notifications
          </a>
        </li>
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" onclick="showSection('privacy')">
            <i class="fas fa-lock"></i>
            Privacy
          </a>
        </li>
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" onclick="showSection('security')">
            <i class="fas fa-shield-alt"></i>
            Security
          </a>
        </li>
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" onclick="showSection('billing')">
            <i class="fas fa-credit-card"></i>
            Billing & Plans
          </a>
        </li>
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" onclick="showSection('integrations')">
            <i class="fas fa-plug"></i>
            Integrations
          </a>
        </li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="settings-main">
      <!-- General Settings Section -->
      <div id="general" class="settings-section active">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-cog"></i>
            General Settings
          </h2>
        </div>

        <form id="generalForm" method="POST" action="{{ url_for('landlord.update_settings') }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

          <input type="hidden" name="section" value="general">

          <div class="form-row">
            <div class="form-group">
              <label for="company_name">Company Name</label>
              <input type="text" id="company_name" name="company_name" class="form-control" 
                     value="{{ settings.company_name or '' }}" placeholder="Enter your company name">
            </div>
            <div class="form-group">
              <label for="timezone">Timezone</label>
              <select id="timezone" name="timezone" class="form-control">
                <option value="UTC">UTC</option>
                <option value="EST">Eastern Time</option>
                <option value="CST">Central Time</option>
                <option value="MST">Mountain Time</option>
                <option value="PST">Pacific Time</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="language">Language</label>
            <select id="language" name="language" class="form-control">
              <option value="en">English</option>
              <option value="es">Spanish</option>
              <option value="fr">French</option>
              <option value="de">German</option>
            </select>
          </div>

          <div class="form-group">
            <label for="currency">Default Currency</label>
            <select id="currency" name="currency" class="form-control">
              <option value="USD">USD - US Dollar</option>
              <option value="EUR">EUR - Euro</option>
              <option value="GBP">GBP - British Pound</option>
              <option value="KES">KES - Kenyan Shilling</option>
            </select>
          </div>

          <div class="form-switch">
            <div>
              <div class="switch-label">Dark Mode</div>
              <div class="switch-description">Use dark theme across the platform</div>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="dark_mode" {{ 'checked' if settings.dark_mode else '' }}>
              <span class="switch-slider"></span>
            </label>
          </div>

          <div class="form-switch">
            <div>
              <div class="switch-label">Compact View</div>
              <div class="switch-description">Show more content in less space</div>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="compact_view" {{ 'checked' if settings.compact_view else '' }}>
              <span class="switch-slider"></span>
            </label>
          </div>

          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Save Changes
          </button>
        </form>
      </div>

      <!-- Notifications Section -->
      <div id="notifications" class="settings-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-bell"></i>
            Notification Preferences
          </h2>
        </div>

        <form id="notificationsForm" method="POST" action="{{ url_for('landlord.update_settings') }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

          <input type="hidden" name="section" value="notifications">

          <h4 class="mb-3">Email Notifications</h4>
          
          <div class="notification-item">
            <div class="notification-info">
              <h5>New Tenant Applications</h5>
              <p>Get notified when new tenants apply for your properties</p>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="email_new_applications" checked>
              <span class="switch-slider"></span>
            </label>
          </div>

          <div class="notification-item">
            <div class="notification-info">
              <h5>Rent Payments</h5>
              <p>Receive notifications when rent is paid or overdue</p>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="email_rent_payments" checked>
              <span class="switch-slider"></span>
            </label>
          </div>

          <div class="notification-item">
            <div class="notification-info">
              <h5>Maintenance Requests</h5>
              <p>Get alerts for new maintenance requests from tenants</p>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="email_maintenance" checked>
              <span class="switch-slider"></span>
            </label>
          </div>

          <div class="notification-item">
            <div class="notification-info">
              <h5>Property Alerts</h5>
              <p>Important updates about your properties</p>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="email_property_alerts" checked>
              <span class="switch-slider"></span>
            </label>
          </div>

          <h4 class="mb-3 mt-4">Push Notifications</h4>
          
          <div class="notification-item">
            <div class="notification-info">
              <h5>Browser Notifications</h5>
              <p>Show notifications in your browser when active</p>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="push_browser" checked>
              <span class="switch-slider"></span>
            </label>
          </div>

          <div class="notification-item">
            <div class="notification-info">
              <h5>Mobile App Notifications</h5>
              <p>Receive notifications on your mobile device</p>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="push_mobile" checked>
              <span class="switch-slider"></span>
            </label>
          </div>

          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Save Preferences
          </button>
        </form>
      </div>

      <!-- Privacy Section -->
      <div id="privacy" class="settings-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-lock"></i>
            Privacy Settings
          </h2>
        </div>

        <form id="privacyForm" method="POST" action="{{ url_for('landlord.update_settings') }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

          <input type="hidden" name="section" value="privacy">

          <div class="security-info">
            <i class="fas fa-info-circle"></i>
            Control how your information is shared and displayed to others
          </div>

          <h4 class="mb-3">Profile Visibility</h4>
          
          <div class="form-switch">
            <div>
              <div class="switch-label">Public Profile</div>
              <div class="switch-description">Allow tenants to view your profile information</div>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="public_profile" {{ 'checked' if settings.public_profile else '' }}>
              <span class="switch-slider"></span>
            </label>
          </div>

          <div class="form-switch">
            <div>
              <div class="switch-label">Show Contact Information</div>
              <div class="switch-description">Display email and phone to verified tenants</div>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="show_contact" {{ 'checked' if settings.show_contact else '' }}>
              <span class="switch-slider"></span>
            </label>
          </div>

          <div class="form-switch">
            <div>
              <div class="switch-label">Property Statistics</div>
              <div class="switch-description">Share anonymous property performance data</div>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="share_stats" {{ 'checked' if settings.share_stats else '' }}>
              <span class="switch-slider"></span>
            </label>
          </div>

          <h4 class="mb-3 mt-4">Data & Analytics</h4>
          
          <div class="form-switch">
            <div>
              <div class="switch-label">Usage Analytics</div>
              <div class="switch-description">Help us improve by sharing usage data</div>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="analytics" checked>
              <span class="switch-slider"></span>
            </label>
          </div>

          <div class="form-switch">
            <div>
              <div class="switch-label">Marketing Communications</div>
              <div class="switch-description">Receive updates about new features</div>
            </div>
            <label class="switch-input">
              <input type="checkbox" name="marketing" checked>
              <span class="switch-slider"></span>
            </label>
          </div>

          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Update Privacy Settings
          </button>
        </form>
      </div>

      <!-- Security Section -->
      <div id="security" class="settings-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-shield-alt"></i>
            Security Settings
          </h2>
        </div>

        <div class="security-info">
          <i class="fas fa-shield-alt"></i>
          Keep your account secure with these security settings
        </div>

        <h4 class="mb-3">Password</h4>
        <form id="passwordForm" method="POST" action="{{ url_for('auth.change_password') }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

          
          <div class="form-row">
            <div class="form-group">
              <label for="current_password">Current Password</label>
              <input type="password" id="current_password" name="current_password" class="form-control" required>
            </div>
            <div class="form-group">
              <label for="new_password">New Password</label>
              <input type="password" id="new_password" name="new_password" class="form-control" required>
              <div class="form-text">Password must be at least 8 characters long</div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="confirm_password">Confirm New Password</label>
            <input type="password" id="confirm_password" name="confirm_password" class="form-control" required>
          </div>

          <button type="submit" class="btn btn-success">
            <i class="fas fa-key"></i> Update Password
          </button>
        </form>

        <h4 class="mb-3 mt-4">Two-Factor Authentication</h4>
        
        <div class="form-switch">
          <div>
            <div class="switch-label">Enable 2FA</div>
            <div class="switch-description">Add an extra layer of security to your account</div>
          </div>
          <label class="switch-input">
            <input type="checkbox" name="two_factor" id="twoFactorToggle">
            <span class="switch-slider"></span>
          </label>
        </div>

        <div id="twoFactorSetup" style="display: none;">
          <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            Scan this QR code with your authenticator app
          </div>
          <div class="text-center mb-3">
            <div style="width: 200px; height: 200px; background: #f0f0f0; margin: 0 auto; display: flex; align-items: center; justify-content: center; border-radius: 10px;">
              <i class="fas fa-qrcode fa-3x text-muted"></i>
            </div>
          </div>
          <div class="form-group">
            <label>Backup Codes</label>
            <div class="alert alert-warning">
              Save these backup codes in a safe place
            </div>
            <div class="form-control" style="font-family: monospace; background: #f8f9fa;">
              1234-5678-9012<br>
              3456-7890-1234<br>
              5678-9012-3456<br>
              7890-1234-5678
            </div>
          </div>
        </div>

        <h4 class="mb-3 mt-4">Active Sessions</h4>
        
        <div class="table-container">
          <table class="settings-table">
            <thead>
              <tr>
                <th>Device</th>
                <th>Location</th>
                <th>Last Active</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <i class="fas fa-laptop me-2"></i>
                  Chrome on Windows
                </td>
                <td>Nairobi, Kenya</td>
                <td>2 minutes ago</td>
                <td>
                  <button class="btn btn-sm btn-outline">Revoke</button>
                </td>
              </tr>
              <tr>
                <td>
                  <i class="fas fa-mobile-alt me-2"></i>
                  Safari on iPhone
                </td>
                <td>Nairobi, Kenya</td>
                <td>1 hour ago</td>
                <td>
                  <button class="btn btn-sm btn-outline">Revoke</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <button class="btn btn-danger mt-3">
          <i class="fas fa-sign-out-alt"></i> Sign Out All Devices
        </button>
      </div>

      <!-- Billing Section -->
      <div id="billing" class="settings-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-credit-card"></i>
            Billing & Plans
          </h2>
        </div>

        <div class="alert alert-info">
          <i class="fas fa-info-circle"></i>
          You are currently on the <strong>Professional Plan</strong>
        </div>

        <h4 class="mb-3">Current Plan</h4>
        <div class="card border-primary mb-4">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h5 class="card-title">Professional Plan</h5>
                <p class="card-text">Perfect for growing landlords with multiple properties</p>
                <ul class="list-unstyled">
                  <li><i class="fas fa-check text-success me-2"></i>Up to 50 properties</li>
                  <li><i class="fas fa-check text-success me-2"></i>Advanced analytics</li>
                  <li><i class="fas fa-check text-success me-2"></i>Priority support</li>
                </ul>
              </div>
              <div class="text-end">
                <h3 class="text-primary">$49<span class="text-muted">/month</span></h3>
                <button class="btn btn-outline-primary btn-sm">Upgrade Plan</button>
              </div>
            </div>
          </div>
        </div>

        <h4 class="mb-3">Payment Method</h4>
        <div class="card mb-4">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center">
                <i class="fab fa-cc-visa fa-2x text-primary me-3"></i>
                <div>
                  <h6 class="mb-0">Visa ending in 4242</h6>
                  <small class="text-muted">Expires 12/24</small>
                </div>
              </div>
              <button class="btn btn-sm btn-outline">Update</button>
            </div>
          </div>
        </div>

        <h4 class="mb-3">Billing History</h4>
        <div class="table-container">
          <table class="settings-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Dec 1, 2024</td>
                <td>Professional Plan - Monthly</td>
                <td>$49.00</td>
                <td><span class="badge bg-success">Paid</span></td>
                <td>
                  <button class="btn btn-sm btn-outline">Download</button>
                </td>
              </tr>
              <tr>
                <td>Nov 1, 2024</td>
                <td>Professional Plan - Monthly</td>
                <td>$49.00</td>
                <td><span class="badge bg-success">Paid</span></td>
                <td>
                  <button class="btn btn-sm btn-outline">Download</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Integrations Section -->
      <div id="integrations" class="settings-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-plug"></i>
            Integrations
          </h2>
        </div>

        <h4 class="mb-3">Connected Accounts</h4>
        
        <div class="connected-account">
          <div class="account-info">
            <div class="account-icon" style="background: #4285f4; color: white;">
              <i class="fab fa-google"></i>
            </div>
            <div class="account-details">
              <h5>Google Calendar</h5>
              <p>Sync property viewings and appointments</p>
            </div>
          </div>
          <button class="btn btn-sm btn-danger">Disconnect</button>
        </div>

        <div class="connected-account">
          <div class="account-info">
            <div class="account-icon" style="background: #0088cc; color: white;">
              <i class="fab fa-stripe"></i>
            </div>
            <div class="account-details">
              <h5>Stripe</h5>
              <p>Process rent payments securely</p>
            </div>
          </div>
          <button class="btn btn-sm btn-danger">Disconnect</button>
        </div>

        <div class="connected-account">
          <div class="account-info">
            <div class="account-icon" style="background: #7289da; color: white;">
              <i class="fab fa-slack"></i>
            </div>
            <div class="account-details">
              <h5>Slack</h5>
              <p>Get notifications in your workspace</p>
            </div>
          </div>
          <button class="btn btn-sm btn-danger">Disconnect</button>
        </div>

        <h4 class="mb-3 mt-4">Available Integrations</h4>
        
        <div class="row">
          <div class="col-md-6 mb-3">
            <div class="card">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="account-icon me-3" style="background: #ff6b6b; color: white;">
                    <i class="fas fa-envelope"></i>
                  </div>
                  <div>
                    <h6 class="mb-1">Mailchimp</h6>
                    <small class="text-muted">Email marketing automation</small>
                  </div>
                </div>
                <button class="btn btn-sm btn-primary mt-2">Connect</button>
              </div>
            </div>
          </div>
          
          <div class="col-md-6 mb-3">
            <div class="card">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="account-icon me-3" style="background: #20c997; color: white;">
                    <i class="fab fa-whatsapp"></i>
                  </div>
                  <div>
                    <h6 class="mb-1">WhatsApp Business</h6>
                    <small class="text-muted">Communicate with tenants</small>
                  </div>
                </div>
                <button class="btn btn-sm btn-primary mt-2">Connect</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %} 

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Get CSRF token from specific form
    function getCsrfToken(formId) {
      const form = document.getElementById(formId);
      if (form) {
        return form.querySelector('input[name="csrf_token"]').value;
      }
      return null;
    }

    // Toast notification function
    function showToast(message, type = "success") {
      const existingToast = document.querySelector(".toast");
      if (existingToast) {
        existingToast.remove();
      }

      const toast = document.createElement("div");
      toast.className = `toast toast-${type}`;
      
      const icon = type === "success" ? "fa-check-circle" : "fa-exclamation-circle";
      toast.innerHTML = `
        <i class="fas ${icon}"></i>
        <span>${message}</span>
      `;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = "slideIn 0.3s ease reverse";
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Show/hide sections
    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.settings-section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Remove active class from all tabs and links
      document.querySelectorAll('.nav-tab, .sidebar-link').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected section
      document.getElementById(sectionId).classList.add('active');
      
      // Add active class to clicked elements
      event.target.classList.add('active');
      
      // Update sidebar
      document.querySelectorAll('.sidebar-link').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(sectionId)) {
          link.classList.add('active');
        }
      });
    }

    // Form submissions
    function handleFormSubmit(formId, successMessage) {
      const form = document.getElementById(formId);
      if (!form) return;

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const submitButton = this.querySelector('button[type="submit"]');
        const originalText = submitButton.innerHTML;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        submitButton.disabled = true;

        const formData = new FormData(this);

        fetch(this.action, {
          method: 'POST',
          headers: {
            'X-CSRFToken': getCsrfToken(formId)
          },
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          submitButton.innerHTML = originalText;
          submitButton.disabled = false;
          
          if (data.success) {
            showToast(successMessage);
          } else {
            showToast(data.message || 'Error saving settings', 'danger');
          }
        })
        .catch(error => {
          submitButton.innerHTML = originalText;
          submitButton.disabled = false;
          showToast('Error saving settings', 'danger');
          console.error('Error:', error);
        });
      });
    }

    // Initialize form handlers
    handleFormSubmit('generalForm', 'General settings saved successfully!');
    handleFormSubmit('notificationsForm', 'Notification preferences saved successfully!');
    handleFormSubmit('privacyForm', 'Privacy settings updated successfully!');

    // Password form validation
    const passwordForm = document.getElementById('passwordForm');
    if (passwordForm) {
      passwordForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const newPassword = document.getElementById('new_password').value;
        const confirmPassword = document.getElementById('confirm_password').value;
        
        if (newPassword !== confirmPassword) {
          showToast('Passwords do not match', 'danger');
          return;
        }
        
        if (newPassword.length < 8) {
          showToast('Password must be at least 8 characters long', 'danger');
          return;
        }

        const submitButton = this.querySelector('button[type="submit"]');
        const originalText = submitButton.innerHTML;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
        submitButton.disabled = true;

        const formData = new FormData(this);

        fetch(this.action, {
          method: 'POST',
          headers: {
            'X-CSRFToken': getCsrfToken('passwordForm')
          },
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          submitButton.innerHTML = originalText;
          submitButton.disabled = false;
          
          if (data.success) {
            showToast('Password updated successfully!');
            this.reset();
          } else {
            showToast(data.message || 'Error updating password', 'danger');
          }
        })
        .catch(error => {
          submitButton.innerHTML = originalText;
          submitButton.disabled = false;
          showToast('Error updating password', 'danger');
          console.error('Error:', error);
        });
      });
    }

    // Two-factor authentication toggle
    const twoFactorToggle = document.getElementById('twoFactorToggle');
    const twoFactorSetup = document.getElementById('twoFactorSetup');
    
    if (twoFactorToggle && twoFactorSetup) {
      twoFactorToggle.addEventListener('change', function() {
        if (this.checked) {
          twoFactorSetup.style.display = 'block';
          showToast('Two-factor authentication setup initiated', 'info');
        } else {
          twoFactorSetup.style.display = 'none';
          showToast('Two-factor authentication disabled', 'info');
        }
      });
    }

    // Session management
    document.querySelectorAll('button[onclick*="Revoke"]').forEach(button => {
      button.addEventListener('click', function() {
        if (confirm('Are you sure you want to revoke this session?')) {
          showToast('Session revoked successfully', 'success');
          this.closest('tr').remove();
        }
      });
    });

    // Integration connect/disconnect
    document.querySelectorAll('.connected-account button.btn-danger').forEach(button => {
      button.addEventListener('click', function() {
        if (confirm('Are you sure you want to disconnect this account?')) {
          showToast('Account disconnected successfully', 'success');
          this.closest('.connected-account').remove();
        }
      });
    });

    document.querySelectorAll('.card button.btn-primary').forEach(button => {
      if (button.textContent.includes('Connect')) {
        button.addEventListener('click', function() {
          showToast('Integration connection initiated', 'info');
          this.textContent = 'Connecting...';
          this.disabled = true;
          
          setTimeout(() => {
            this.textContent = 'Connected';
            this.classList.remove('btn-primary');
            this.classList.add('btn-success');
            this.disabled = false;
          }, 2000);
        });
      }
    });
  });
</script>
{% endblock %}