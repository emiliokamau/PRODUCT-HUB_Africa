{% extends 'base.html' %}
{% block title %}Chat{% endblock %}
{% block content %}
<h2>Chat with {{ user.name }}</h2>
<div id="chat-box" style="border:1px solid #ccc; height:300px; overflow:auto; padding:10px;">
  {% for message in messages %}
    <p><strong>{{ 'You' if message.sender_id == current_user.id else user.name }}:</strong> {{ message.content }}</p>
  {% endfor %}
</div>

<form id="chat-form">
  <input type="text" id="chat-input" placeholder="Type your message..." />
  <button type="submit">Send</button>
</form>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
  const socket = io();
  const chatBox = document.getElementById("chat-box");
  const chatInput = document.getElementById("chat-input");
  const chatForm = document.getElementById("chat-form");

  chatForm.addEventListener("submit", function(e) {
    e.preventDefault();
    const msg = chatInput.value;
    if (msg.trim()) {
      socket.send(msg);
      chatBox.innerHTML += `<p><strong>You:</strong> ${msg}</p>`;
      chatInput.value = '';
    }
  });

  socket.on("message", function(msg) {
    chatBox.innerHTML += `<p><strong>Partner:</strong> ${msg}</p>`;
    chatBox.scrollTop = chatBox.scrollHeight;
  });
</script>
{% endblock %}
